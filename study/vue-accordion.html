<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>霍梦林的个人博客 | 未使用事件委托实现vue手风琴</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/46.styles.b646c9c7.css" as="style"><link rel="preload" href="/assets/js/app.21af4b7a.js" as="script"><link rel="preload" href="/assets/js/5.f5b66771.js" as="script"><link rel="prefetch" href="/assets/js/23.62bfb48a.js"><link rel="prefetch" href="/assets/js/0.ad434982.js"><link rel="prefetch" href="/assets/js/1.de00d4e2.js"><link rel="prefetch" href="/assets/js/2.8e4568be.js"><link rel="prefetch" href="/assets/js/3.ba3de1c7.js"><link rel="prefetch" href="/assets/js/4.ed75d86a.js"><link rel="prefetch" href="/assets/js/6.ac2b7510.js"><link rel="prefetch" href="/assets/js/7.849df679.js"><link rel="prefetch" href="/assets/js/8.32604b3f.js"><link rel="prefetch" href="/assets/js/9.65cc79e2.js"><link rel="prefetch" href="/assets/js/10.bee2823d.js"><link rel="prefetch" href="/assets/js/11.dbec1204.js"><link rel="prefetch" href="/assets/js/12.4cc4f4b0.js"><link rel="prefetch" href="/assets/js/13.fb4a1834.js"><link rel="prefetch" href="/assets/js/14.d2671700.js"><link rel="prefetch" href="/assets/js/15.31de3449.js"><link rel="prefetch" href="/assets/js/16.357740a9.js"><link rel="prefetch" href="/assets/js/17.285d1748.js"><link rel="prefetch" href="/assets/js/18.924155d6.js"><link rel="prefetch" href="/assets/js/19.d96ed59a.js"><link rel="prefetch" href="/assets/js/20.67ee3641.js"><link rel="prefetch" href="/assets/js/21.3443a30e.js"><link rel="prefetch" href="/assets/js/22.15d6b2e5.js"><link rel="prefetch" href="/assets/js/24.bbcffed2.js"><link rel="prefetch" href="/assets/js/25.2d46b06d.js"><link rel="prefetch" href="/assets/js/26.18ff9f32.js"><link rel="prefetch" href="/assets/js/27.eb667acf.js"><link rel="prefetch" href="/assets/js/28.00a64dc0.js"><link rel="prefetch" href="/assets/js/29.0dd9e08c.js"><link rel="prefetch" href="/assets/js/30.356525db.js"><link rel="prefetch" href="/assets/js/31.b9ad12f5.js"><link rel="prefetch" href="/assets/js/32.bc18723d.js"><link rel="prefetch" href="/assets/js/33.395c2652.js"><link rel="prefetch" href="/assets/js/34.dc6f2133.js"><link rel="prefetch" href="/assets/js/35.cff13afc.js"><link rel="prefetch" href="/assets/js/36.e1ccc63a.js"><link rel="prefetch" href="/assets/js/37.87a3a50b.js"><link rel="prefetch" href="/assets/js/38.20975580.js"><link rel="prefetch" href="/assets/js/39.fe1ec382.js"><link rel="prefetch" href="/assets/js/40.0fa937cf.js"><link rel="prefetch" href="/assets/js/41.1dfcb875.js"><link rel="prefetch" href="/assets/js/42.f3ddae5b.js"><link rel="prefetch" href="/assets/js/43.c234813d.js"><link rel="prefetch" href="/assets/js/44.ee33685d.js"><link rel="prefetch" href="/assets/js/45.d7f97673.js">
    <link rel="stylesheet" href="/assets/css/46.styles.b646c9c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      霍梦林的个人博客
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/problem/" class="nav-link">Problem</a></div><div class="nav-item"><a href="/study/" class="nav-link router-link-active">Study</a></div><div class="nav-item"><a href="http://blog.csdn.net/weixin_38318244/" target="_blank" rel="noopener noreferrer" class="nav-link">CSDN</a></div><div class="nav-item"><a href="https://github.com/momo-0902" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/problem/" class="nav-link">Problem</a></div><div class="nav-item"><a href="/study/" class="nav-link router-link-active">Study</a></div><div class="nav-item"><a href="http://blog.csdn.net/weixin_38318244/" target="_blank" rel="noopener noreferrer" class="nav-link">CSDN</a></div><div class="nav-item"><a href="https://github.com/momo-0902" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><!----></nav><ul class="sidebar-links"><li><a href="/study/" class="sidebar-link">学习笔记</a></li><li><a href="/study/axios.html" class="sidebar-link">1.axios</a></li><li><a href="/study/document.html" class="sidebar-link">2.document</a></li><li><a href="/study/css.html" class="sidebar-link">3.css</a></li><li><a href="/study/css-selector.html" class="sidebar-link">4.css选择器</a></li><li><a href="/study/flex.html" class="sidebar-link">5.flex</a></li><li><a href="/study/git.html" class="sidebar-link">6.git</a></li><li><a href="/study/html.html" class="sidebar-link">7.html</a></li><li><a href="/study/http.html" class="sidebar-link">8.http</a></li><li><a href="/study/input.html" class="sidebar-link">9.input</a></li><li><a href="/study/js-basis.html" class="sidebar-link">10.js语言基础</a></li><li><a href="/study/RSA-encrypt.html" class="sidebar-link">12.RSA加密</a></li><li><a href="/study/vue-router.html" class="sidebar-link">13.vue-router</a></li><li><a href="/study/vue.html" class="active sidebar-link">14.vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/vue-accordion.html#vue如何使用disabled" class="sidebar-link">vue如何使用disabled</a></li><li class="sidebar-sub-header"><a href="/study/vue-accordion.html#mixins" class="sidebar-link">mixins</a></li><li class="sidebar-sub-header"><a href="/study/vue-accordion.html#vue-将选中项写入json备用" class="sidebar-link">vue 将选中项写入json备用</a></li></ul></li><li><a href="/study/vuex.html" class="sidebar-link">15.vuex</a></li><li><a href="/study/vuePress.html" class="sidebar-link">16.vuePress</a></li><li><a href="/study/zepto.html" class="sidebar-link">17.zepto</a></li><li><a href="/study/code-optimization.html" class="sidebar-link">18.代码逻辑优化</a></li><li><a href="/study/scroll-page-bottom.html" class="sidebar-link">19.判断是否滚动到页面底部</a></li><li><a href="/study/find-the-cause-of-error.html" class="sidebar-link">20.找错误原因</a></li><li><a href="/study/local-cache.html" class="sidebar-link">21.本地缓存</a></li><li><a href="/study/algorithm.html" class="sidebar-link">22.算法</a></li><li><a href="/study/vue-accordion.html" class="active sidebar-link">23.vue使用事件委托实现手风琴</a></li><li><a href="/study/generator.html" class="sidebar-link">24.异步编程-generator</a></li><li><a href="/study/capture-debugging-tool.html" class="sidebar-link">25.抓包调试工具</a></li><li><a href="/study/art-template.html" class="sidebar-link">26.art-template</a></li><li><a href="/study/bootstrap-datepicker.html" class="sidebar-link">27.bootstrap-datepicker</a></li><li><a href="/study/simulation-form-submit.html" class="sidebar-link">28.模拟form提交表单</a></li><li><a href="/study/echarts.html" class="sidebar-link">29.echarts封装渲染和部分配置</a></li><li><a href="/study/return-specific-date.html" class="sidebar-link">30.返回某个月的某个星期几</a></li><li><a href="/study/prevent-duplicate-request.html" class="sidebar-link">31.防止接口重复请求</a></li><li><a href="/study/table.html" class="sidebar-link">32.table的操作</a></li><li><a href="/study/not-yet-classified.html" class="sidebar-link">33.暂未分类</a></li></ul></div><div class="page"><div class="content"><h1 id="未使用事件委托实现vue手风琴"><a href="#未使用事件委托实现vue手风琴" aria-hidden="true" class="header-anchor">#</a> 未使用事件委托实现vue手风琴</h1><pre class="language-text"><code>uvar Vue = require('vue-plus');
var config = require('config');

var component = Vue.extend({

	data: function() {
		return {
			list: [],
			page: 1,
			hasMore: true,
			isShowLoading: false,
			loadingTip: '',
			// 详情数据数组
			infos: [],
			current: {},
			rate: 0
		};
	},

	template: __inline('./list.tpl'),

	methods: {
		toggleDetail: function ($event, ctime, which) {
			// 获取当前元素,即当前列表项
			var $curr = $event.currentTarget;
			// 返回列表项的下一个同胞（位于同一列表中）
			var currentItem = $curr.nextElementSibling;
			// 获取下一列表项的display属性
			var display = currentItem.style.display;
			// 获取当前列表项的第一个子元素的第二个子元素，即img旋转图标
			var img = $event.currentTarget.children[0].children[1];
			// 获取所有详情数据模块，结果为一个数组
			var $details = document.querySelectorAll('.bg-fcfcfc');
			// 获取所有旋转图标，结果为一个数组
			var $imgs = document.querySelectorAll('.angle');

			// 循环详情数组，（当点击此列表时，）如果此详情数组是显示的，那就让它隐藏，实现切换，同时改变旋转图标的样式
			for(var i = 0, l = $details.length; i &lt; l; i++) {
				if($details[i].style.display === '') {
					$details[i].style.display = 'none';
					$imgs[i].className        = 'angle fr';
				}
			}

		// 如果下一列表项是隐藏的，
			if(display === 'none') {
				//显示
				// 如果当前详情项在列表详情数组里为未空，那就请求接口
				if(!this.infos[which]) {
					var promise = Vue.ajax({
							url: 'http://qlll.dev.zhongfl.com/api/account/Interestdetail',
							method: 'post',
							// 提交列表项的时间
							data: {date: ctime}
						})
						.success(reqSuccess(function(resp) {
							// 将请求数据赋值给当前详情列表中对应当前条目的那一项
							this.infos[which] = resp.data;
							// 将请求数据赋值给当前详情项
							this.current = resp.data;
							//
							if(!resp.data.activity){
								this.rate = 0;
							} else {
								this.rate = resp.data.activity.rate;
								currentItem.style.display = '';
								img.className = 'angle fr angleRotate';
							}
						}, this));
				} else {
					this.current = this.infos[which];
					currentItem.style.display = '';
					img.className = 'angle fr angleRotate';
				}
			} else {
				//隐藏
				img.className = 'angle fr';
				currentItem.style.display = 'none';
			}
		},

		onScrollBottom: function() {
			if (isBottomOnScroll()) {
				if (this.hasMore) {
					this.fetchData();
				} else {
					window.onscroll = null;
				}
			}
		},
		fetchData: function() {
			this.isShowLoading = true;
			this.loadingTip  = '正在加载...';
			var promise = Vue.ajax({
				url: 'http://qlll.dev.zhongfl.com/api/account/interestlist',
				method: 'get',
				data: {
					page: this.page,
					len: 15			//安卓手机列表第一页数据过少导致不能滚动。
				}
			})
			.success(reqSuccess(function(resp) {
				var list = resp.data.list;
				if (list.length &gt; 0) {
					this.isShowLoading = false;
					this.list = this.list.concat(list);
					this.page += 1;
				} else {
					this.isShowLoading = true;
					this.loadingTip = '没有更多数据了';
					this.hasMore = false;
				}
			}, this));
		}
	},

	ready: function() {
		this.fetchData();
		window.onscroll = this.onScrollBottom.bind(this);
		var $details = document.querySelectorAll('.bg-fcfcfc');
		var $imgs    = document.querySelectorAll('.angle');

		for(var i = 0, l = $details.length; i &lt; l; i++) {
			$details[i].style.display = 'none';
			$imgs[i].className        = 'angle fr';
		}
	}

});

/* @require ./style.less */
module.exports = {component: component};

</code></pre><h1 id="事件委托简单例子"><a href="#事件委托简单例子" aria-hidden="true" class="header-anchor">#</a> 事件委托简单例子</h1><pre class="language-text"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh-cn&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0&quot;&gt;
  &lt;title&gt;钱隆归来了&lt;/title&gt;
  &lt;style media=&quot;screen&quot;&gt;
    ul{
      list-style: none;
      background:#ff0;

    }
    ul li{
      padding:10px 0;
      background:#cdcdcd;
      border-bottom:1px solid #ddd;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;ul id=&quot;ul&quot;&gt;
      &lt;li&gt;
          &lt;p&gt;
            li里面的p
            &lt;span&gt;span1&lt;/span&gt;
            &lt;span&gt;span2&lt;/span&gt;
            &lt;span&gt;span3&lt;/span&gt;
          &lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;222&lt;/li&gt;
      &lt;li&gt;333&lt;/li&gt;
      &lt;li&gt;444&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
window.onload=function(){
  //循环li
  
  var ul=document.getElementById(&quot;ul&quot;)
  ul.onclick=function(event){
      console.log(this)
      console.log(event)
      console.log(event.nodeName)
      var ev = ev || window.event;
　　  var target = ev.target || ev.srcElement;
　　  if(target.nodeName.toLowerCase() == 'li'||target.nodeName.toLowerCase() == 'p'||target.nodeName.toLowerCase() == 'span'){
  　　　 alert('触发了li');
　　   }
  }
}
&lt;/script&gt;
&lt;/html&gt;
</code></pre><h1 id="使用事件委托实现vue手风琴组件"><a href="#使用事件委托实现vue手风琴组件" aria-hidden="true" class="header-anchor">#</a> 使用事件委托实现vue手风琴组件</h1><pre class="language-text"><code>html：
&lt;ul class=&quot;daily daliprob&quot; @click=&quot;toggle($event)&quot; &gt;



import * as iakit from 'iakit'
import { queryInterestListInfo, interestDetailInfo } from 'services'
import create from './index.tpl'
import './index.styl'
import isReachBottom from 'helper/isReachBottom'

export default create({
  data() {
    return {
      listData: [],
      detailInfo: [],
      current: {
        basic: {},
        newcomer: [],
        new_come_rate: '',
        activity: [],
        commission: []
      },
      rate: 0,
      page: 1,
      // 是否有更多数据
      hasMore: true,
      // 是否显示加载更多数据信息
      isShowLoading: true
    }
  },
’
  created() {
    this.queryInterestList()
    // 为窗体添加滚动事件 RreachBottom,判断是否滑动到了页面底部
    window.addEventListener('scroll', this.RreachBottom)
  },

  methods: {
    getNode(node) {
      if (node.nodeName === 'LI') {
        return node
      } else if (node.nodeName === 'UL') {
        return false
      } else {
        return this.getNode(node.parentNode)
      }
    },

    toggle(e) {
      var target = e.target || e.srcElement
      var $li = document.querySelectorAll('li')
      // thisLi 当前点击li的e.target
      var thisLi = this.getNode(target)
      // 获取所有列表项，生成数组
      var $details = document.querySelectorAll('.earnDetail')
      // 获取所有旋转图标，生成数组
      var $icons = document.querySelectorAll('.eranIcon')
      for (let i = 0, length = $li.length; i &lt; length; i++) {
        if (thisLi === $li[i]) {
          if ($details[i].style.display === '') {
            // div展开时，将它隐藏
            $details[i].style.display = 'none'
            $icons[i].className = 'eranIcon'
          } else {
            // 隐藏时，将它展开
            // 如果当前详情项数组里无对应此项数据
            if (!this.detailInfo[i]) {
              let ctime = thisLi.children[0].children[0].innerHTML
              interestDetailInfo(
                {
                  'data': ctime
                }
              ).then((resp) =&gt; {
                // 将请求到的详情项放入详情数组中
                this.detailInfo[i] = resp
                // 将请求详情项赋值给当前详情项，以供显示
                this.current = resp
                if (!this.activity) {
                  this.rate = 0
                } else {
                  this.rate = this.activity.rate
                }
              }).catch((err) =&gt; {
                iakit.alert('', err.message, [
                  {
                    text: '朕知道了'
                  }
                ])
              })
            } else {
              // 如果详情项数组中有对应此项数据，就将数组中的数据赋值给当前详情项，以供显示
              this.current = this.detailInfo[i]
            }
            $details[i].style.display = ''
            $icons[i].className = 'eranIcon rotate'
          }
        } else {
          $details[i].style.display = 'none'
          $icons[i].className = 'eranIcon'
        }
      }
    },

    queryInterestList() {
      // 判断数据是否正在加载中，以防重复加载
      if (this.fetching) {
        return
      }
      this.fetching = true
      this.isShowLoading = true
      this.loadingTip = '正在加载中...'
      queryInterestListInfo({
        page: this.page,
        len: 15
      }).then((resp) =&gt; {
        const data = resp.list
        // 成功后不显示提示信息，数据加载完毕
        this.isShowLoading = false
        this.fetching = false
        if (data &amp;&amp; data.length &gt; 0) { // 存在数据，用concat连接每次请求的数组项
          this.listData = this.listData.concat(data)
        } else { // 没有更多数据了
          this.hasMore = false
          this.isShowLoading = true
          this.loadingTip = '没有更多数据了'
        }
        // 请求页标志加1,即当再次请求时请求下一页
        this.page += 1
      }).catch((err) =&gt; {
        this.fetching = false
        iakit.alert('', err.message, [
          {
            text: '朕知道了'
          }
        ])
      })
    },

    RreachBottom() {
      // 如果滚动到页面底部，并且当前选项卡为投资项
      if (isReachBottom()) {
        // 判断接口还有无数据 ，如果有，就再次请求接口
        if (this.hasMore) {
          this.queryInterestList()
        } else {
          // 如果没有数据，就解绑此事件
          window.onscroll = null
        }
      }
    }
  }
})

</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/study/algorithm.html" class="prev">
          22.算法
        </a></span><span class="next"><a href="/study/generator.html">
          24.异步编程-generator
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/5.f5b66771.js" defer></script><script src="/assets/js/app.21af4b7a.js" defer></script>
  </body>
</html>
